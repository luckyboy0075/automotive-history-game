<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel | Automotive History Game</title>

    <!-- Load Decap CMS Scripts -->
    <script src="https://unpkg.com/decap-cms@latest/dist/decap-cms.js" defer></script>
</head>
<body>
    <h1>Loading Admin Panel...</h1>

    <script>
        function registerAuth0Backend() {
            if (typeof CMS === "undefined") {
                console.error("❌ CMS is not loaded. Retrying in 2s...");
                setTimeout(registerAuth0Backend, 2000);
                return;
            }

            console.log("✅ Decap CMS successfully loaded.");

            // Register Auth0 manually
            try {
                CMS.registerBackend("auth0", {
                    init: (config) => {
                        return {
                            authProvider: "auth0",
                            config
                        };
                    },
                    authenticate: (credentials) => {
                        return new Promise((resolve, reject) => {
                            console.log("🔐 Authenticating with Auth0...");
                            // Simulate an Auth0 response
                            resolve({
                                token: "mocked-auth0-token",
                                user: { email: "user@petrolheadsgame.com" }
                            });
                        });
                    },
                    logout: () => {
                        console.log("🚪 Logging out from Auth0...");
                    }
                });
                console.log("✅ Auth0 backend manually registered.");
            } catch (error) {
                console.error("❌ Failed to register Auth0 backend manually:", error);
            }
        }

        // Ensure CMS is loaded before registering the Auth0 backend
        window.addEventListener("load", registerAuth0Backend);
    </script>

</body>
</html>
